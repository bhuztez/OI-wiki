<%inherit file="base.html"/>

<%block name="title">${entry["title"]}</%block>

<%block name="footer">
<div class="row">
<div class="col l5">
本页面的全部内容在 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> 和 <a href="https://github.com/zTrix/sata-license">SATA</a> 协议之条款下提供，附加条款亦可能应用
</div>
<%
authors = [
  author
  for author in registry.find_all({"type": "author"})
  if any(email in entry["authors"] for email in author.get("emails", []))]
author_emails = [email for author in authors for email in author["emails"]]
%>

% if entry["authors"]:
<div class="col l3">
<h5>本页面贡献者</h5>
<ul>
%   for author in authors:
<li><a class="grey-text text-lighten-3" href="${urls.build('author.html', {'slug': author['slug']})}">${author["name"]}</a></li>
%   endfor
%   for author in entry["authors"]:
%     if author not in author_emails:
<li>${author}</li>
<% warn("%s: author %r not found" % (filename, author)) %>
%     endif
%   endfor
</ul>
</div>
% endif

<%
pages = [
  page
  for page in registry.find_all({"type": "wiki"})
  if entry["slug"] in page.get("tags", [])]
%>

<div class="col l3">
<h5>链接</h5>
<ul>
<li><a class="grey-text text-lighten-3" href="https://github.com/OI-wiki/OI-wiki/commits/master/${filename}">更新历史</a></li>
<li><a class="grey-text text-lighten-3" href="https://github.com/OI-wiki/OI-wiki/blob/master/${filename}">在 GitHub 上编辑此页！</a></li>
% if pages:
<li><a class="grey-text text-lighten-3" href="${urls.build('tagged.html', {'slug': entry['slug']})}">pages tagged with "${entry["title"]}"</a></li>
% endif
</ul>
</div>

</div>
</%block>

% if entry.get("canonical", None) is not None:
<%     canonical = registry.find({"type": "wiki", "slug": entry["canonical"]}) %>
<h4>Source:</h4>
<a href="${urls.build('wiki.html', {'slug': canonical['slug']})}">${canonical["title"]}</a>
% endif

<%
canonicals = [
  canonical
  for canonical in registry.find_all({"canonical": entry["slug"]})]
%>
% if canonicals:
<h4>Canonicals</h4>
<ul>
%   for canonical in canonicals:
<a href="${urls.build('wiki.html', {'slug': canonical['slug']})}">${canonical["title"]}</a>
%   endfor
</ul>
% endif

<article>
${content | n}
</article>

<%
tags = [
  tag
  for tag in registry.find_all({"type": "wiki"})
  if tag.get("slug", None) in entry["tags"]]
tag_slugs = [tag["slug"] for tag in tags]
%>

% if entry["tags"]:
<p>
%   for tag in tags:
<a class="btn" href="${urls.build('wiki.html', {'slug': tag['slug']})}">${tag["title"]}</a>
%   endfor
%   for tag in entry["tags"]:
%     if tag not in tag_slugs:
<span class="btn">${tag}</span>
<% warn("%s: tag %r not found" % (filename, tag)) %>
%     endif
%   endfor
</p>
% endif
